---
services:
  mysql:
    image: ghcr.io/gkostin1966/mysql:latest
    container_name: mysql-db
    environment:
      - MARIADB_ROOT_PASSWORD=password
      - MARIADB_USER=ihs
      - MARIADB_PASSWORD=password
      - MARIADB_ROOT_HOST=localhost
      - MARIADB_MYSQL_LOCALHOST_USER=non_empty_value
      - MARIADB_DATABASE=ihs
      - INDEPENDENT_HANDLE_SERVER_PREFIX=IHS
    ports:
      - 3306:3306/tcp
  ihs:
    image: ghcr.io/gkostin1966/ihs-handle-server:latest
    container_name: ihs-srv
    restart: always
    environment:
      - MARIADB_HOST=mysql
      - MARIADB_USER=ihs
      - MARIADB_PASSWORD=password
      - MARIADB_DATABASE=ihs
      - INDEPENDENT_HANDLE_SERVER_PREFIX=IHS
    ports:
      - 2641:2641/tcp
      - 2641:2641/udp
      - 8000:8000/tcp
  spec:
    image: ghcr.io/gkostin1966/handle_rest:latest
    container_name: spec-cmd
    environment:
      - MARIADB_HOST=mysql
      - MARIADB_USER=ihs
      - MARIADB_PASSWORD=password
      - MARIADB_DATABASE=ihs
      - INDEPENDENT_HANDLE_SERVER_PREFIX=IHS
      - INTEGRATION=1
      - HS_REST_URL=https://ihs:8000/api/handles
      - HS_PREFIX=IHS
      - HS_USER=300:IHS/IHS
      - HS_PASSWORD=password
      - HS_SSL_VERIFY=0
    command: ["./bin/wait-for-http-service.sh", "http://ihs:8000", "bundle", "exec", "rspec"]
